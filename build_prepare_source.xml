<project basedir="./apache-nutch-1.8" default="prepare-source" xmlns:ivy="antlib:org.apache.ivy.ant" xmlns:ac="antlib:net.sf.antcontrib">
	<target name="prepare-source">
		<delete dir="../apache-nutch-1.8" />
		<unzip src="../apache-nutch-1.8-src.zip" dest="../" />
		<!-- remove not needed nutch resources -->
        <delete dir="../apache-nutch-1.8/docs" />
        <delete dir="../apache-nutch-1.8/src/test" />
        <delete dir="../apache-nutch-1.8/src/testresources" />
		<!-- generate a pom file -->

		<typedef uri="antlib:org.apache.ivy.ant" onerror="fail" loaderRef="ivyLoader">
			<classpath>
				<pathelement location="./ivy/ivy-2.2.0.jar" />
			</classpath>
		</typedef>
		<fail>
			<condition>
				<not>
					<typefound uri="antlib:org.apache.ivy.ant" name="cleancache" />
				</not>
			</condition>
	          You need Apache Ivy 2.0 or later from http://ant.apache.org/
	          It could not be loaded from ${ivy.repo.url}
	        </fail>

		<condition property="ivy.found">
			<typefound uri="antlib:org.apache.ivy.ant" name="cleancache" />
		</condition>

		<ivy:settings file="./ivy/ivysettings.xml" />

		<ivy:makepom ivyfile="./ivy/ivy.xml" pomfile="./pom_nutch.xml" templatefile="./ivy/mvn.template">
			<mapping conf="default" scope="compile" />
			<mapping conf="runtime" scope="runtime" />
		</ivy:makepom>
		
        <replace file="./pom_nutch.xml">
            <replacetoken><![CDATA[<plugins>]]></replacetoken>
            <replacevalue><![CDATA[<plugins>
            	<plugin>
  	                <groupId>org.codehaus.mojo</groupId>
   	                <artifactId>build-helper-maven-plugin</artifactId>
   	                <executions>
                        <execution>
                        <phase>generate-sources</phase>
                         <goals>
                              <goal>add-source</goal>
                         </goals>
                         <configuration>
                            <sources>
                            </sources>
                         </configuration>
                         </execution>
                    </executions>
                </plugin>]]></replacevalue>
        </replace>
		
		<taskdef resource="net/sf/antcontrib/antcontrib.properties">
		  <classpath>
		    <pathelement location="/usr/share/java/lib/ant-contrib-0.3.jar"/>
		  </classpath>
		</taskdef>
		
		
		
		

	</target>
</project>